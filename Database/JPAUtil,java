package com.studybuddy.db;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.Persistence;

/**
 * Utility class to manage the JPA EntityManagerFactory.
 * This class should be used to acquire an EntityManager for database operations.
 */
public class JpaUtil {

    private static EntityManagerFactory entityManagerFactory;

    // Static block runs once when the class is loaded
    static {
        try {
            // Load configuration from persistence.xml using the unit name
            entityManagerFactory = Persistence.createEntityManagerFactory("StudyBuddyPU");
            System.out.println("JPA EntityManagerFactory initialized successfully.");
        } catch (Exception ex) {
            System.err.println("Initial EntityManagerFactory creation failed: " + ex.getMessage());
            // In a real app, log this exception and maybe shut down the application
            throw new ExceptionInInitializerError(ex);
        }
    }

    /**
     * Retrieves a new EntityManager instance.
     * The EntityManager is the runtime interface for interacting with the persistence context (the database).
     * Callers must remember to close the EntityManager when done.
     * * @return A new EntityManager instance.
     */
    public static EntityManager getEntityManager() {
        return entityManagerFactory.createEntityManager();
    }

    /**
     * Closes the entire application's EntityManagerFactory.
     * Should be called only once when the application is shutting down.
     */
    public static void shutdown() {
        if (entityManagerFactory != null && entityManagerFactory.isOpen()) {
            entityManagerFactory.close();
            System.out.println("JPA EntityManagerFactory closed.");
        }
    }
    
    // Example usage:
    /*
    public static void main(String[] args) {
        EntityManager em = JpaUtil.getEntityManager();
        System.out.println("Acquired EntityManager: " + em);
        
        // --- Perform Database Operations Here ---
        
        em.close();
        JpaUtil.shutdown();
    }
    */
}